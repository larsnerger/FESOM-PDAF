! Namelist for PDAF configuration 
&pdaf

! General settings for PDAF:
delt_obs_ocn=32        ! Time step interval between filter analyses
                       ! for daily obs, this should be set equal to 
                       ! step_per_day in namelist.config
filtertype=7           ! Choose filter algorithm
locweight=4            ! Set weighting function for localization
local_range=2.0e5      ! Cut-off radius for localization
srange=2.0e5           ! Support radius for weighting function
forget=1.000           ! Set forgetting factor
resetforget=.false.
loctype=0
varscale=1.0
type_trans=1           ! Type of ensemble transformation in (L)ESTKF/(L)SEIK/(L)ETKF
type_forget=0          ! Set type of forgetting factor
screen=2               ! set verbosity of PDAF
printconfig=.true.
twin_experiment=.false.
step_null=0
days_since_DAstart=1

perturb_ssh   = .true.
perturb_u     = .true.
perturb_v     = .true.
perturb_temp  = .true.
perturb_salt  = .true.
perturb_DIC   = .true.
perturb_Alk   = .true.
perturb_DIN   = .true.
perturb_O2    = .true.

path_init='/albedo/work/projects/p_recompdaf/frbunsen/modelruns/BGC9_covar/dist72/'
file_init='cov_'
DAoutput_path='/albedo/work/user/lnerger/SOCRA/test_new/DA-out/'

ASIM_START_USE_CLIM_STATE=.false.
this_is_pdaf_restart=.false.
start_from_ENS_spinup=.true.
use_global_obs=0

ASSIM_O_ssh = .false.
path_obs_ssh='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/SSH/CMEMS/CORE2/dist_72/'
file_ssh_prefix='SSH_track_2016_dist72_'
file_ssh_suffix ='.nc'
rms_obs_ssh= 0.05
ssh_fixed_rmse=.true.
bias_obs_ssh=0.5
lradius_ssh=3.0e5

ASSIM_O_sst = .true.
path_obs_sst='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/SST/OSTIA/CORE2/dist_72/'
file_sst_prefix='OSTIA_SST_20160101_20161231_daily_dist72_'
file_sst_suffix ='.nc'
rms_obs_sst=0.8
sst_fixed_rmse=.true.
sst_exclude_ice=.true.
sst_exclude_diff=2.4 ! Rule of thumb: 3 times observation error (typically 0.8 degC --> 2.4 degC)

ASSIM_O_sss = .false.
path_obs_sss='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/SSS/ESA_SMOS/CORE2/dist_72/'
file_sss_prefix='SMOS_SSS_2016_dist72_'
file_sss_suffix ='.nc'
rms_obs_sss=0.5
sss_fixed_rmse=.true.
sss_exclude_ice=.true.
sss_exclude_diff=0

ASSIM_O_sss_cci = .true.
path_obs_sss_cci='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/SSS/CCI/CORE2/dist_72/'
file_sss_cci_prefix=''
file_sss_cci_suffix ='.nc'
rms_obs_sss_cci=0.5
sss_cci_fixed_rmse=.true.
sss_cci_exclude_ice=.true.
sss_cci_exclude_diff=0

ASSIM_O_en4_t = .true.
ASSIM_O_en4_s = .true.
path_obs_prof='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/Temp-Salt-3D/EN4/fesom-pdaf-processed_dist_72/'
file_prof_prefix='obs_profile_'
file_prof_suffix='.nc'
rms_obs_T=0.8
rms_obs_S=0.5

! if "proffiles_o=1", a routine is called that processes EN4 raw data and distributes the observations to the model grid. The programme ends afterwards without entering the main model time stepping loop (no simulation). 
 
path_obs_rawprof='/albedo/work/projects/p_recompdaf/frbunsen/data/physics/Temp-Salt-3D/EN4/'
file_rawprof_prefix='EN.4.2.2.f.profiles.c14.'
proffiles_o=0  ! 0: No processing of EN4 raw profile data.
               ! 1: Processing of EN4 raw profile data to distributed files.
start_year_o = 2016
end_year_o   = 2016

assim_o_chl_cci = .true.
rms_obs_chl_cci = 0.3
path_obs_chl_cci = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/chlsurf_OC-CCI/CORE2_daily/dist_72/'
file_chl_cci_prefix = ''
file_chl_cci_suffix = '.nc'
chl_cci_exclude_ice = .true.
chl_cci_exclude_diff = 0
bias_obs_chl_cci = 1           !  0: Do not de-bias observations.
                               ! >0: De-bias observations using bias field from input file to be specified below.
chl_cci_fixed_rmse = .false.
chl_logarithmic = .true.
path_bias = '/albedo/work/projects/p_recompdaf/frbunsen/modelruns/fesom2/update_BGC_tests/FREE/work/01/chlobsdiff_dist72/'
file_bias_prefix = 'chlobsdiff.runmean.smooth.core2.dist72_'

assim_o_DIC_glodap = .true.
path_obs_DIC_glodap = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/GLODAP/DIC_molkg/'
rms_obs_DIC_glodap = 4
DIC_glodap_exclude_diff = 200

assim_o_Alk_glodap = .true.
path_obs_Alk_glodap = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/GLODAP/Alk_molkg/'
rms_obs_Alk_glodap = 4
Alk_glodap_exclude_diff = 250

assim_o_pCO2_SOCAT = .true.
path_obs_pCO2_SOCAT = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/SOCAT/pCO2/'
rms_obs_pCO2_SOCAT = 5
pCO2_SOCAT_exclude_diff = 700

assim_o_O2_comf = .false.
path_obs_O2_comf = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/COMFORT/O2/'
rms_obs_O2_comf = 2
o2_comf_exclude_diff = 120

assim_o_N_comf = .false.
path_obs_N_comf = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/COMFORT/DIN/'
rms_obs_N_comf = 0.3
n_comf_exclude_diff = 15

assim_o_O2_argo = .false.
path_obs_O2_argo = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/ARGO/O2/'
rms_obs_O2_argo = 2
o2_argo_exclude_diff = 120

assim_o_N_argo = .false.
path_obs_N_argo = '/albedo/work/projects/p_recompdaf/frbunsen/data/BGC/ARGO/DIN/'
rms_obs_N_argo = 0.3
N_argo_exclude_diff = 20

assim_o_O2_merged = .true.
path_obs_O2_merged = '/albedo/work/user/frbunsen/data/BGC/O2_molkg/'
rms_obs_O2_merged = 10
o2_merged_exclude_diff = 0
o2_merged_excl_absolute = 125
o2_merged_excl_relative = 0.9

assim_o_N_merged = .true.
path_obs_N_merged = '/albedo/work/user/frbunsen/data/BGC/DIN_molkg/'
rms_obs_N_merged = 2
N_merged_exclude_diff = 0
N_merged_excl_absolute = 20
N_merged_excl_relative = 0 

! Wether to perturb BGC parameters:
perturb_params_bio=.true.
perturb_params_phy=.true.
perturb_scale=0.25

assimilateBGC=.true.
assimilatePHY=.true.
/

! Settings for Parallelization:
&pdaf_parallel

dim_ens=4
/

! Which state variables to be affected by the assimilation:
&updated

upd_ssh   =.true.
upd_u     =.true.
upd_v     =.true.
upd_w     =.false.      ! not updated to increase stability
upd_temp  =.true.
upd_salt  =.true.
upd_ice   =.false.      ! required for observation exclusion criterion; not affected by assimilation
upd_MLD1  =.false.      ! diagnostic
upd_MLD2  =.false.      ! diagnostic
upd_sigma =.false.      ! required for unit conversion 

upd_PhyChl    = .true.
upd_DiaChl    = .true.
upd_DIC       = .true.
upd_DOC       = .true.
upd_Alk       = .true.
upd_DIN       = .true.
upd_DON       = .true.
upd_O2        = .true.
upd_pCO2s     = .true.    ! assimilated model diagnostic
upd_CO2f      = .true.    ! assimilated model diagnostic
upd_DiaN      = .true.
upd_DiaC      = .true.
upd_DiaSi     = .true.
upd_PAR       = .false.   ! diagnostic
upd_NPPn      = .false.   ! diagnostic
upd_NPPd      = .false.   ! diagnostic
upd_DetC      = .true.
upd_DetCalc   = .true.
upd_DetN      = .true.
upd_DetSi     = .true.
upd_Det2C     = .true.
upd_Det2Calc  = .true.
upd_Det2N     = .true.
upd_Det2Si    = .true.
upd_PhyC      = .true.
upd_PhyN      = .true.
upd_PhyCalc   = .true.
upd_export    = .false.  ! diagnostic
upd_alphaCO2  = .false.  ! diagnostic
upd_PistonVel = .false.  ! diagnostic
upd_Zo1C      = .true.
upd_Zo1N      = .true.
upd_Zo2C      = .true.
upd_Zo2N      = .true.
/

! Namelist for atmosphere stochasticity:
&atmos_stoch

path_atm_cov = '/albedo/work/projects/p_recompdaf/frbunsen/data/jra_core2/dist72_cov/'

disturb_xwind=.true.
disturb_ywind=.true.
disturb_humi=.true.
disturb_qlw=.true.
disturb_qsr=.true.
disturb_tair=.true.
disturb_prec=.false.
disturb_snow=.false.
disturb_mslp=.true.

varscale_wind = 0.2
varscale_tair = 1.0
varscale_humi = 1.0
varscale_qlw  = 1.0

write_atmos_st = .false. ! whether to protocol perturbed atmospheric fields (every member at every step)
/

! Namelist for postprocessing:
! if "isPP=True", a routine is called that compares existing output and observations. The programme does not run a simulation.
&pp
isPP = .false.
yearPP = 2010
pathsim(1)='/albedo/work/projects/p_recompdaf/frbunsen/modelruns/fesom2/update_BGC_tests/FREE/work/01/'
pathsim(2)='/albedo/work/projects/p_recompdaf/frbunsen/modelruns/fesom2/update_BGC_tests/test_DIC/work/01/'
/

! Namelist for output frequency, predefined cases:
&pdafoutput
setoutput( 1)=.false. ! daily forecast and analysis, ensemble members
setoutput( 2)=.false. ! daily forecast and analysis, ensemble mean
setoutput( 3)=.true.  ! monthly forecast and analysis, ensemble mean of updated variables
setoutput( 4)=.false. ! daily m-fields, ensemble mean
setoutput( 5)=.false. ! initial fields, ensemble mean
setoutput( 6)=.false. ! initial fields, ensemble members
setoutput( 7)=.true.  ! monthly m-fields, ensemble mean
setoutput( 8)=.false. ! daily m-fields of assimilated variables, ensemble mean
setoutput( 9)=.true.  ! daily m-fields of assimilate-able BGC variables, ensemble mean
setoutput(10)=.true.  ! daily m-fields of CO2 flux and pCO2, ensemble mean
setoutput(11)=.true.  ! daily m-fields of variables defining the CO2 flux
setoutput(12)=.false. ! initial fields standard deviation
setoutput(13)=.false. ! daily forecast of standard deviation
setoutput(14)=.false. ! monthly forecast of standard deviation
setoutput(15)=.true.  ! monthly forecast and analysis of standard deviation for updated fields
setoutput(16)=.true.  ! monthly m-fields of standard deviation
setoutput(17)=.false. ! if O2 and/or DIN assimilated: daily forecasts
setoutput(18)=.false. ! daily analysis of assimilate-able BGC variables, ensemble mean
/

